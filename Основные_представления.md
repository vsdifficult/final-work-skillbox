# Основные представления архитектуры

Функциональное представление

Архитектура системы основана на микросервисном подходе и событийной модели (Event-Driven). Каждый сервис отвечает за ограниченную предметную область и взаимодействует с другими сервисами через REST или асинхронно — посредством топиков событий.

Основные сервисы:
- User Service
 Хранит данные пользователей, обрабатывает регистрацию, профили и их обновления.


- Auth Service
 Предоставляет функции аутентификации и авторизации, управляет JWT-токенами, реализует контроль доступа ко всем API.


- Training Service
 Отвечает за CRUD-операции с тренировками, фиксирует прогресс и публикует события “TrainingCompleted”.


- Recommendation Service
 Генерирует рекомендации на основе событий пользователя и данных тренировок.


- Communication Service
 Управляет чатами, уведомлениями, отправляет push-уведомления через интеграцию с Firebase.


- Tracking Service
 Обрабатывает данные устройств (DeviceDataEvent), анализирует телеметрию, публикует события для аналитики.


- Integration Service
 Отвечает за внешние интеграции и преобразование данных от устройств и сторонних API.


- API Gateway (единая точка входа для клиента)
 Обеспечивает маршрутизацию запросов, rate limiting, троттлинг, CORS, агрегацию API.


Хранилища:

Postgres DB — структурированные данные пользователей и тренировок.


S3 Storage — файлы, мультимедиа, документы, вложения в чатах.


Event Topics — Kafka/Redpanda:


- Training Events Topic


- Tracking Events Topic


- FriendAdded Event Topic


- DeviceDataEvent Topic


Архитектура обеспечивает независимое масштабирование сервисов, гибкость и простоту эволюции.

Информационное представление

Типы данных в системе:

Пользовательские данные


профили, настройки, друзья


токены аутентификации


связи «пользователь — тренировки»


Данные тренировок


расписание


результаты


завершённые тренировки


метрики прогресса


Чат-коммуникации


сообщения


вложения (хранятся в S3)


пуш-уведомления


Данные устройств (DeviceDataEvent)


телеметрия


частота сердечных сокращений


шаги / GPS


состояние устройства


Событийная информация (EDA)
 События передаются между сервисами без прямой связи.
 Примеры:


UserAdded


TrainingCreated


TrainingCompleted


FriendAdded


DeviceDataEvent


Таким образом, коммуникация между сервисами минимизирует связность, повышая устойчивость и расширяемость.

Представление многозадачности (concurrency)

В системе используются несколько уровней параллелизма:

Асинхронная обработка очередей событий



Kafka/Redpanda обеспечивает масштабируемый и отказоустойчивый стриминг.


Каждый сервис может параллельно обрабатывать множество партиций.


Горизонтальное масштабирование сервисов


Kubernetes увеличивает количество подов при росте нагрузки.


Stateless-сервисы масштабируются наиболее эффективно.


Изоляция нагрузки


Нагрузочные пики на Training Service не влияют на User Service.


Push Notification сервис может быть масштабирован независимо.


Параллельные REST-запросы через API Gateway


Отдельные worker-пулы


обработка тяжелых задач Recommendations Service


агрегация данных Tracking Service


Благодаря этому система выдерживает высокую нагрузку и кратные всплески активности (например, массовые завершения тренировок вечером).

Инфраструктурное представление

Компоненты инфраструктуры:

API Gateway — Nginx/Traefik/Kong.


Service Mesh (по желанию) — Istio/Linkerd.


Kubernetes Cluster — развертывание всех сервисов.


Message Broker — Kafka/Redpanda.


Storage:


PostgreSQL (master + реплика)


S3-compatible storage


CI/CD Pipeline


GitHub Actions / GitLab CI


автоматический деплой в k8s


Мониторинг и логирование


Prometheus


Grafana


Loki + Tempo (tracing)


Инфраструктура позволяет быстро масштабировать систему, обновлять сервисы без остановки и отслеживать состояние каждого компонента.

Представление безопасности

В системе реализованы следующие меры безопасности:

Контроль доступа

JWT-аутентификация



ролевая модель (RBAC)


валидация разрешений на уровне Gateway + каждого сервиса


Шифрование

HTTPS/TLS между клиентом и API Gateway


mTLS внутри сервисов (при использовании Service Mesh)


Изоляция данных

отдельные БД и схемы для каждого сервиса


атрибутивный доступ к данным


минимизация прав доступа сервисов


Безопасность событий

подпись сообщений


защита от повтора событий


аудит критичных действий


DDoS и rate limiting

применяется на уровне API Gateway и Load Balancer


Архитектура учитывает НФТ по безопасности и соответствует best practices микросервисной экосистемы.



