# Основные представления архитектуры фитнес-платформы

## Функциональное представление

Архитектура основана на **микросервисном подходе** и **событийной модели (Event-Driven Architecture)**.  
Каждый сервис отвечает за ограниченную предметную область и взаимодействует с другими через REST или асинхронно — через топики событий.

### Основные сервисы

- **User Service**  
  Хранит данные пользователей, обработка регистрации, профилей и обновлений.

- **Auth Service**  
  Аутентификация и авторизация, управление JWT-токенами, контроль доступа ко всем API.

- **Training Service**  
  CRUD-тренировок, фиксация прогресса, публикация события `TrainingCompleted`.

- **Recommendation Service**  
  Генерация рекомендаций на основе событий пользователя и данных тренировок.

- **Communication Service**  
  Чаты, уведомления, push-уведомления через Firebase.

- **Tracking Service**  
  Обработка данных устройств (`DeviceDataEvent`), аналитика телеметрии, публикация событий.

- **Integration Service**  
  Внешние интеграции, преобразование данных от устройств и сторонних API.

- **API Gateway**  
  Единая точка входа, маршрутизация, rate limiting, throttling, CORS, агрегация API.

### Хранилища

- **PostgreSQL** — структурированные данные пользователей и тренировок  
- **S3 Storage** — файлы, мультимедиа, документы, вложения в чатах  
- **Event Topics (Kafka / Redpanda)**:  
  - `TrainingEventsTopic`  
  - `TrackingEventsTopic`  
  - `FriendAddedEventTopic`  
  - `DeviceDataEventTopic`  

Архитектура обеспечивает независимое масштабирование сервисов и простоту эволюции.

---

## Информационное представление

### Типы данных

**Пользовательские данные:**

- профили, настройки, друзья  
- токены аутентификации  
- связи «пользователь — тренировки»

**Данные тренировок:**

- расписание  
- результаты  
- завершённые тренировки  
- метрики прогресса

**Чат-коммуникации:**

- сообщения  
- вложения (S3)  
- push-уведомления

**Данные устройств (`DeviceDataEvent`):**

- телеметрия  
- частота сердечных сокращений  
- шаги / GPS  
- состояние устройства

**Событийная информация (EDA):**

- `UserAdded`  
- `TrainingCreated`  
- `TrainingCompleted`  
- `FriendAdded`  
- `DeviceDataEvent`

Коммуникация через события минимизирует связанность и повышает устойчивость.

---

## Представление многозадачности (concurrency)

### Уровни параллелизма

- **Асинхронная обработка очередей**  
  Kafka/Redpanda → масштабируемый и отказоустойчивый стриминг  
  Каждый сервис может параллельно обрабатывать множество партиций

- **Горизонтальное масштабирование сервисов**  
  Kubernetes увеличивает количество подов при росте нагрузки  
  Stateless-сервисы масштабируются эффективно

- **Изоляция нагрузки**  
  Пики на Training Service не влияют на User Service  
  Push Notification сервис масштабируется независимо

- **Параллельные REST-запросы через API Gateway**  
  Отдельные worker-пулы для тяжелых задач  
  - Recommendations Service → обработка и агрегация данных  
  - Tracking Service → агрегация телеметрии

Система выдерживает высокую нагрузку и массовые всплески активности.

---

## Инфраструктурное представление

### Компоненты

- **API Gateway** — Nginx / Traefik / Kong  
- **Service Mesh (опционально)** — Istio / Linkerd  
- **Kubernetes Cluster** — развертывание сервисов  
- **Message Broker** — Kafka / Redpanda  

### Хранилища

- PostgreSQL (master + реплика)  
- S3-compatible storage  

### CI/CD Pipeline

- GitHub Actions / GitLab CI  
- Автоматический деплой в Kubernetes  

### Мониторинг и логирование

- Prometheus  
- Grafana  
- Loki + Tempo (tracing)  

Инфраструктура позволяет масштабировать систему, обновлять сервисы без остановки и отслеживать состояние компонентов.

---

## Представление безопасности

### Контроль доступа

- JWT-аутентификация  
- Ролевая модель (RBAC)  
- Валидация разрешений на уровне Gateway и сервисов

### Шифрование

- HTTPS/TLS между клиентом и API Gateway  
- mTLS внутри сервисов (при Service Mesh)

### Изоляция данных

- отдельные БД и схемы для каждого сервиса  
- атрибутивный доступ к данным  
- минимизация прав доступа сервисов

### Безопасность событий

- подпись сообщений  
- защита от повторной доставки  
- аудит критичных действий

### DDoS и rate limiting

- на уровне API Gateway и Load Balancer

Архитектура учитывает все требования безопасности и соответствует best practices микросервисной экосистемы.
