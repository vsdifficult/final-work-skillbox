# План поэтапной разработки системы

---

## 1. Определение доменных границ и зон ответственности

### Цели
- Разделить существующую функциональность по четким bounded contexts.
- Снизить связанность внутри монолита.
- Подготовить основу для микросервисов.

### Действия
- Анализ текущих модулей:  
  тренировки, трекинг, социальные функции, коммуникации, занятия, интеграции, уведомления.
- Формирование доменных контекстов:  
  **Training**, **Tracking**, **Social**, **Notifications**, **Inventory**, **Integrations**, **User Profile**, **Analytics**.
- Определение входов/выходов контекстов.
- Формирование карты событий (event map).
- Фиксация зависимостей между доменами.

---

## 2. Предварительное разбиение монолита на внутренние модули

### Цели
- Подготовить кодовую базу к отделению сервисов.
- Убрать прямые зависимости.

### Действия
- Создать отдельные пакеты/папки для доменов.
- Ввести интерфейсы вместо прямых вызовов классов.
- Перевести доменные взаимодействия на события внутри монолита.
- Убрать cross-domain SQL JOIN.
- Подготовить репозитории и DTO под разделение.

---

## 3. Проектирование API и контрактов взаимодействия

### Цели
- Обеспечить чёткие границы между будущими сервисами.
- Исключить возвращение к монолитным связям.

### Действия
- Описать REST/gRPC API для каждого домена.
- Определить входные/выходные модели и ограничения.
- Описать схемы событий (JSON Schema / Protobuf).
- Ввести версионирование API (v1, v2).
- Подготовить OpenAPI-спеки.

---

## 4. Подготовка отдельных хранилищ данных

### Цели
- Обеспечить независимость сервисов.
- Снизить конкуренцию за ресурсы.

### Действия
- Создать отдельные базы/схемы для:
  - training-db  
  - tracking-db  
  - social-db  
  - notifications-db  
  - inventory-db  
  - integrations-db  
  - analytics-db
- Разделить таблицы по bounded contexts.
- Удалить кросс-сервисные JOIN.
- Настроить миграции (Flyway/Liquibase).
- Подготовить механизмы eventual consistency.

---

## 5. Подготовка инфраструктуры микросервисов

### Цели
- Обеспечить возможность сборки и деплоя каждого сервиса.

### Действия
- Создать Dockerfile для каждого будущего сервиса.
- Собрать Docker-образы.
- Создать базовые Helm Charts или k8s-манифесты:
  - Deployment
  - Service
  - ConfigMap
  - Secret
- Ввести CI/CD:
  - build → test → security scan → push → deploy.

---

## 6. Развёртывание окружения

### Цели
- Создать рабочую платформу для микросервисов.

### Действия
- Поднять Kubernetes-кластер (AKS / GKE / EKS / k3s).
- Создать namespace по средам:
  - dev
  - stage
  - prod
- Настроить сетевую модель:
  - Ingress
  - PodSecurityPolicy (или PSA)
  - RBAC
- (Опционально) Внедрить Service Mesh (Istio/Linkerd).

---

## 7. Введение API Gateway

### Цели
- Централизовать взаимодействие клиентов с системой.
- Защитить и скрыть внутреннюю структуру сервисов.

### Действия
- Настроить API Gateway (Kong / Tyk / NGINX / Ambassador).
- Ввести:
  - rate limiting  
  - аутентификацию (OAuth2/JWT)  
  - авторизацию (RBAC/ABAC)  
  - rewrite/transform правил  
- Реализовать маршрутизацию:
  - /training → training-service  
  - /tracking → tracking-service  
  - /social → social-service  
  - /users → user-service
  - /integrations → integration-service

---

## 8. Переход на асинхронное взаимодействие

### Цели
- Уменьшить связанность.
- Увеличить отказоустойчивость и масштабируемость.

### Действия
- Настроить брокер сообщений: Kafka / RabbitMQ / NATS.
- Определить ключевые события:
  - training.started  
  - training.completed  
  - tracking.metrics.received  
  - user.inventory.updated  
  - friend.activity.updated  
  - integration.sync.failed  
- Организовать event-driven взаимодействия между сервисами.
- Ввести dead-letter queue, retry, backoff.

---

## 9. Масштабирование сервисов

### Цели
- Обеспечить стабильную работу под высокой нагрузкой.

### Действия
- Настроить горизонтальное масштабирование (HPA).
- Создать реплики сервисов с высокой нагрузкой:
  - tracking-service  
  - integrations-service  
  - analytics-service
- Настроить балансировку нагрузки (Ingress + DNS).

---

## 10. Введение системы наблюдаемости

### Цели
- Обеспечить контроль, диагностику и стабильность работы системы.

### Действия
- Внедрить мониторинг:
  - Prometheus + Grafana.
- Настроить логи:
  - Loki / ELK Stack / Graylog.
- Настроить алертинг:
  - SLA/SLO отвалы
  - рост ошибок
  - падение производительности
- Ввести распределённую трассировку (Jaeger / OpenTelemetry).
- Создать дашборды для:
  - Training
  - Tracking
  - Social
  - Integrations
  - Gateway

---

## 11. Постепенный вывод сервисов из монолита (Strangler Pattern)

### Цели
- Безопасно избавиться от монолита.
- Избежать больших релизов.

### Действия
- Переносить домены по одному:
  - сначала Tracking,
  - затем Training,
  - затем Social,
  - затем остальное.
- Перенаправлять маршруты через API Gateway.
- Удалять старые модули после полной миграции.

---

## 12. Дальнейшее развитие

### Возможные направления
- Добавление рекомендательных моделей на базе ML.  
- Введение real-time соревнований.  
- Локализация промо-акций.  
- Ещё более глубокая интеграция с устройствами (Bluetooth/ANT+).  
- Выделение analytics-сервиса для big data.  

---

