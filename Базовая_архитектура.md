
# Базовая архитектура  

Базовая архитектура системы строится на модульном монолите, выбранном как наиболее сбалансированное решение для стадии MVP. Такой подход позволяет обеспечить достаточную гибкость, строгое разделение доменов и подготавливает платформу к последующей миграции в микросервисную архитектуру без серьезной переработки бизнес-логики. 

Каждый модуль содержит:
- Domain layer — бизнес-логика, сущности


- Application layer — сервисы и сценарии


- Infrastructure layer — БД, кэш, внешние клиенты


- API layer — контроллеры, DTO 

После этого используем уже ранее описанный функционал в пункте “Концептуальная архитектура”. 

# Общая конвенция API 
- Базовый протокол HTTPS (TLS 1.2 +) 
- Формат JSON (UTF-8) 
- Версионирование URL: /v1/… (позже /v2/.. при breaking changes) 
- Аутентификация: OAuth2 (Bearer JWT); для внутренних сервисов - mTLS 
- Идемпотентность: для операции создание (POST) поддержка Idempotency-Key (желательно 24-72 часа) 
- Пагинация: cursor-based (recommended) или ?page=&limit=; в ответе — next_cursor. 

- Фильтрация/сортировка: query-параметры ?filter=...&sort=... 

- Формат ошибок: стандарт RFC 7807 (problems + json) с полями:  type, title, status, detail, instance, code 

- Ограничения скорости: per-user / per-client rate-limits (например 100 req/min базовый, 1000 req/min для trusted)

- Логи и трассировки: каждый запрос должен нести X-Request-Id (или сгенерировать на gateway) и traceparent для OpenTelemetry. 

- Privacy: PII в ответах маскируется при отсутствии consents; путь к удалению — DELETE /v1/users/{id}/data (Right to be forgotten). 

- Paging и массивы — всегда возвращаем метаданные + массив: { "meta": {...}, "data": [...] }. 




# Спроектируем API 


1. Сервис тренировок (Training Service)
   
Основные сущности: тренировка, упражнение, план, программа.


Создать тренировку
```
POST /trainings
{
  "userId": "uuid",
  "title": "Грудь + Трицепс",
  "description": "Тренировка для роста массы",
  "exercises": [
    {
      "name": "Жим лежа",
      "sets": 4,
      "reps": 8,
      "weight": 80
    }
  ],
  "durationMinutes": 55
}
```

Ответ
```
{
  "trainingId": "uuid",
  "status": "created"
}
```
2. Сервис коммуникаций (Communication Service)
   
Чаты, сообщения, уведомления

Отправка сообщения

POST /messages/send
```
{
  "senderId": "uuid",
  "receiverId": "uuid",
  "text": "Привет! Начинаю тренировку.",
  "attachments": []
}
```

 Ответ
```
{
  "messageId": "uuid",
  "delivered": true
}
```

3. Сервис занятий (Sessions Service)
   
Онлайн-занятия, расписание, участие пользователей

Создать занятие

POST /sessions
```
{
  "coachId": "uuid",
  "title": "Онлайн-йога",
  "startTime": "2025-02-01T18:00:00Z",
  "durationMinutes": 45,
  "capacity": 50
}
```
Ответ
```
{
  "sessionId": "uuid",
  "status": "scheduled"
}
```


4. Сервис трекинга статистик (Tracking Service)
   
Пульс, шаги, калории, показатели с датчиков, прогресс

Отправить данные трекинга

POST /tracking/data
```
{
  "userId": "uuid",
  "timestamp": "2025-02-01T10:21:00Z",
  "metrics": {
    "heartRate": 132,
    "steps": 4500,
    "calories": 230,
    "distanceKm": 3.1
  }
}
```
Ответ
```
{
  "status": "saved",
  "recordId": "uuid"
}
```

5. Сервис мониторинга системы (Monitoring Service)
   
Метрики, ошибки, логирование, здоровье сервисов

Запрос состояния микросервисов

GET /monitoring/health

Ответ
```
{
  "trainingService": "healthy",
  "communicationService": "healthy",
  "trackingService": "degraded",
  "sessionsService": "healthy",
  "integrationService": "healthy"
}
```

Отправка ошибки из сервиса

POST /monitoring/error
```
{
  "service": "training-service",
  "level": "ERROR",
  "message": "Database connection timeout",
  "timestamp": "2025-02-01T10:20:00Z"
}
```


6. Сервис интеграции с фитнес-приложениями (Integration Service)
   
Синхронизация с Apple Health, Google Fit, Garmin, Xiaomi, Huawei и др.

Импорт активности

POST /integrations/import
```
{
  "provider": "google-fit",
  "userId": "uuid",
  "token": "oauth-access-token",
  "data": {
    "steps": 8200,
    "calories": 520,
    "distanceKm": 5.2,
    "heartRateAvg": 118
  }
} 
```



Ответ
```
{
  "status": "synced",
  "source": "google-fit"
}
```


7. Общий API Gateway 
```
{
  "/api/trainings/*": "training-service",
  "/api/messages/*": "communication-service",
  "/api/sessions/*": "sessions-service",
  "/api/tracking/*": "tracking-service",
  "/api/monitoring/*": "monitoring-service",
  "/api/integrations/*": "integration-service"
}
```
