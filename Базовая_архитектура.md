# Базовая архитектура 

## Общий подход

Архитектура системы построена на **микросервисном подходе** с применением **Event-Driven Architecture (EDA)**.  
Это обеспечивает:

- масштабируемость;
- слабую связанность сервисов;
- независимое развертывание;
- быструю обработку событий.

Каждый сервис отвечает за свой бизнес-домен.

### Основные сервисы

- **User Service** — управление пользователями  
- **Training Service** — тренировки и расписания  
- **Communication Service** — чаты и сообщения  
- **Tracking Service** — получение данных с устройств  
- **Recommendation Service** — персональные рекомендации  
- **Integration Service** — интеграции с внешними API и трекерами  

Коммуникация построена через **Kafka**, обеспечивая реакцию в реальном времени.

---

# Бизнес-требования

Система должна поддерживать:

- большое число пользователей и тренировок (тысячи параллельных запросов);
- мгновенные уведомления о событиях;
- интеграции с фитнес-устройствами;
- отправку push-уведомлений (Firebase);
- историю тренировок и событий трекинга;
- чаты и коммуникации в реальном времени;
- хранение медиафайлов в S3-совместимом хранилище.

### Ключевые характеристики

- высокая масштабируемость  
- низкая задержка  
- отказоустойчивость  
- безопасность данных  

---

# Нефункциональные требования и архитектурные решения

## Производительность
- API Gateway + Load Balancer  
- Асинхронная обработка через Kafka  

## Масштабируемость
- Stateless микросервисы  
- Kafka partitioning и consumer-группы  

## Отказоустойчивость
- Независимость сервисов  
- Повторная доставка сообщений Kafka  

## Безопасность
- Auth Service за API Gateway  
- Сервисные токены  
- Изолированные базы данных  

## Расширяемость
Добавление новых сервисов не требует изменения существующих.  
Достаточно подписаться на события:

- `TrainingCompletedEvent`
- `FriendAddedEvent`
- `DeviceDataEvent`

---

# Компоненты архитектуры

## Клиенты
- Мобильное приложение  
- Веб-клиент  

Все запросы проходят через API Gateway.

## Load Balancer
Распределяет трафик между инстансами API Gateway.

## API Gateway — функции
- маршрутизация  
- rate-limiting  
- аутентификация  
- кэширование  

## Auth Service
- JWT  
- авторизация/аутентификация  

---

# Бизнес-сервисы

### **User Service**
- управление аккаунтами  
- профили пользователей  
- событие `FriendAddedEvent`  

### **Training Service**
- расписание тренировок  
- завершение тренировок  
- событие `TrainingCompletedEvent` → `TrainingEventsTopic`  

### **Communication Service**
- чаты и сообщения  
- подписка на события друзей  

### **Tracking Service**
- прием данных устройств  
- публикация `DeviceDataEvent`  

### **Recommendation Service**
- анализ событий  
- push-уведомления через Firebase  

### **Integration Service**
- внешние API и фитнес-трекеры  
- генерация событий трекинга  

---

# Event Topics

| Топик | Генерирует | Потребляет | Назначение |
|------|------------|------------|------------|
| **TrainingEventsTopic** | Training Service | Recommendation, Communication | Реакция на тренировки |
| **FriendAddedEventTopic** | User Service | Communication, Recommendation | Уведомления о друзьях |
| **TrackingEventsTopic** | Tracking / Integration | Recommendation | Аналитика |
| **DeviceDataEvent** | Integration Service | Tracking Service | Сырые данные устройств |
| **TrainingCompletedEvent** | Training Service | Recommendation | Рекомендации, уведомления |

---

# Хранилища

- **PostgreSQL** — пользователи, тренировки, чаты  
- **Kafka** — события и потоки данных  
- **S3-совместимое хранилище** — медиа  

---

# Атрибуты качества

| Атрибут | Механизм реализации |
|--------|---------------------|
| Масштабируемость | Stateless микросервисы, Kafka partitioning |
| Производительность | Асинхронные события, балансировка нагрузки |
| Отказоустойчивость | Повторная доставка Kafka, независимые сервисы |
| Безопасность | Auth Service, изоляция БД |
| Модульность | Разделение на bounded contexts |
| Расширяемость | Подписка на готовые события |
| Интеграции | Integration Service + event streams |

---

# Итоговое обоснование

Архитектура **Event-Driven Microservices** полностью соответствует требованиям фитнес-платформы:

- большое количество событий в системе (трекинг, тренировки, взаимодействие пользователей);
- необходимость обработки в реальном времени;
- одинаковая нагрузка не на все сервисы (трекинг и пуши — самые тяжелые);
- требования к простому расширению.

Система устойчива, масштабируема и готова к расширению функциональности («искусственный тренер», новые форматы данных, новые интеграции).

---
